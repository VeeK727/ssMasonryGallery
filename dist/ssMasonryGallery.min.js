(function(c,f,h,a){var e="ssMasonryGallery",b={mode:"rows",responsive:[{breakpoint:0,rowHeight:400,columns:1},{breakpoint:480,rowHeight:250,columns:2},{breakpoint:720,rowHeight:250,columns:2},{breakpoint:1024,rowHeight:300,columns:4},{breakpoint:1440,rowHeight:300,columns:6},{breakpoint:1920,rowHeight:300,columns:8}],margin:5,gallery:true,onLoad:function(){}};function j(m,l){this.element=m;this.options=c.extend({},b,l);this._defaults=b;this._name=e;this.init();}function k(m,n){var l;c.each(m.options.responsive,function(o,p){if(p.breakpoint<n){l=o;}});return l;}function d(m,l,o,q){var n=[],s=m.top,p=m.options.margin,r=row=rowWidth=rowHeight=0;c(l).each(function(u){n.push(u);var B=false;var x=this.naturalWidth,z=this.naturalHeight,A=x/z,y=Math.floor(o*A);if(rowHeight==0){rowHeight=o;}if(y>q&&u==0){y=q-p;rowHeight=y/A;B=true;}rowWidth+=y+p;var v={top:s,left:r,width:y,height:rowHeight};c(this).data("position",v);r=r+y+p;if(rowWidth>q){var w=n.length,D=w*p;var C=(rowWidth-D)/rowHeight,t=Math.floor((q-D)/C);imagesInThisRow=c(l).slice(n[0],n.slice(-1)[0]+1);d(m,imagesInThisRow,t,q);B=true;}if(B){s=s+rowHeight+p;m.top=s;rowWidth=rowHeight=r=0;n=[];}});m.elemHeight=s+rowHeight;c(l).each(function(){var t=c(this).data().position;c(this).css(t);});}function g(v,s,o,u){var r=[],t=v.top,n=0,p=v.options.margin,m=(u-(p*o))/o;for(var q=0;q<o;q++){r.push(0);}console.log(r);c(s).each(function(){var B=Math.min.apply(Math,r),z=r.indexOf(B),C=this.naturalWidth,D=this.naturalHeight,E=C/D;var x=z*m+z*p,A=r[z],w=Math.floor(m/E);var y={left:x,top:A,width:m,height:w};c(this).css(y);r[z]+=w+p;});var l=Math.max.apply(Math,r);v.elemHeight=l;}function i(l,r,t){var m=c(f).outerWidth();var s=Math.ceil(l.width());var p=k(t,m);t.elemHeight=0;t.top=0;if(t.options.mode=="rows"){if(!("rowHeight" in t.options.responsive[p])){throw Error('You have selected "row" mode but haven\'t specified "rowHeight" option. Please check documentation for details');}var q=t.options.responsive[p].breakpoint;var o=t.options.responsive[p].rowHeight;d(t,r,o,s);l.height(t.elemHeight);}else{if(t.options.mode=="columns"){if(!("columns" in t.options.responsive[p])){throw Error('You have selected "column" mode but haven\'t specified "columns" option. Please check documentation for details');}var n=t.options.responsive[p].columns;g(t,r,n,s);l.height(t.elemHeight);}}}c.extend(j.prototype,{init:function(){if(this.options.responsive[0].breakpoint!=0){throw Error("First breakpoint must be 0 (Zero)");}var m,o,l;m=this;o=c(this.element);l=o.children("img");o.addClass("ssMasonryGallery-cont");i(o,l,this);if(this.options.gallery){o.addClass("ssMasonryGallery-gallery");var p='<div id="ssMasonryGallery-projector"><button type="button" class="ssMasonryGallery-close">x</button><img src=""><p class="ssMasonryGallery-caption"></p></div>';c("body").append(p);var q=c("#ssMasonryGallery-projector");l.on("click",function(){if(c(this).data("highres")){var r=c(this).data("highres");}else{var r=c(this).attr("src");}q.find("img").attr("src",r);if(c(this).data("caption")){q.find(".ssMasonryGallery-caption").html(c(this).data("caption")).addClass("show");}q.addClass("active");});c("#ssMasonryGallery-projector .ssMasonryGallery-close").on("click",function(){c(this).closest("#ssMasonryGallery-projector").removeClass("active");c(this).siblings(".ssMasonryGallery-caption").removeClass("show");});c(document).on("keyup",function(r){if(r.keyCode==27){q.removeClass("active");q.find(".ssMasonryGallery-caption").removeClass("show");}});}var n;c(f).on("resize orientationchange",function(){clearTimeout(n);n=setTimeout(function(){i(o,l,m);},500);});this.options.onLoad.call(o);}});c.fn[e]=function(l){var m;this.each(function(){m=c.data(this,"plugin_"+e);if(!m){m=new j(this,l);c.data(this,"plugin_"+e,m);}});return m;};}(jQuery,window,document));